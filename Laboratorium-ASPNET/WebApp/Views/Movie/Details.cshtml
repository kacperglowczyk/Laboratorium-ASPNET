@model WebApp.Models.Movies.Movie

@{
ViewData["Title"] = $"Details - {Model.Title}";
Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <h1>@Model.Title</h1>
    <div class="accordion" id="movieDetailsAccordion">
        <!-- Basic Info -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#basicInfo">
                    Basic Information
                </button>
            </h2>
            <div id="basicInfo" class="accordion-collapse collapse show" data-bs-parent="#movieDetailsAccordion">
                <div class="accordion-body">
                    <dl class="row">
                        <dt class="col-sm-3">Release Date</dt>
                        <dd class="col-sm-9">@(Model.ReleaseDate?.ToString("d") ?? "N/A")</dd>

                        <dt class="col-sm-3">Runtime</dt>
                        <dd class="col-sm-9">@(Model.Runtime != null ? $"{Model.Runtime} minutes" : "N/A")</dd>

                        <dt class="col-sm-3">Budget</dt>
                        <dd class="col-sm-9">@(Model.Budget?.ToString("C0") ?? "N/A")</dd>

                        <dt class="col-sm-3">Revenue</dt>
                        <dd class="col-sm-9">@(Model.Revenue?.ToString("C0") ?? "N/A")</dd>

                        <dt class="col-sm-3">Vote Average</dt>
                        <dd class="col-sm-9">@(Model.VoteAverage?.ToString("N1") ?? "N/A") / 10</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Overview -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#overview">
                    Overview
                </button>
            </h2>
            <div id="overview" class="accordion-collapse collapse" data-bs-parent="#movieDetailsAccordion">
                <div class="accordion-body">
                    @(Model.Overview ?? "No overview available.")
                </div>
            </div>
        </div>

        <!-- Cast -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#cast">
                    Cast
                </button>
            </h2>
            <div id="cast" class="accordion-collapse collapse" data-bs-parent="#movieDetailsAccordion">
                <div class="accordion-body">
                    @if (Model.MovieCasts?.Any() == true)
                    {
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Actor</th>
                                <th>Character</th>
                                <th>Gender</th>
                            </tr>
                            </thead>
                            <tbody>
                            @foreach (var cast in Model.MovieCasts.OrderBy(c => c.CastOrder))
                            {
                            <tr>
                                <td>@(cast.Person?.PersonName ?? "Unknown")</td>
                                <td>@(cast.CharacterName ?? "Unknown")</td>
                                <td>@(cast.Gender?.Gender1 ?? "Unknown")</td>
                            </tr>
                            }
                            </tbody>
                        </table>
                    </div>
                    }
                    else
                    {
                    <p>No cast information available.</p>
                    }

                    <!-- "Add to Cast" button moved inside the Cast section -->
                    <div class="mt-3">
                        <a asp-action="AddCast" asp-route-id="@Model.MovieId" class="btn btn-primary">Add to cast</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Genres -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#genres">
                    Genres
                </button>
            </h2>
            <div id="genres" class="accordion-collapse collapse" data-bs-parent="#movieDetailsAccordion">
                <div class="accordion-body">
                    @if (Model.MovieGenres?.Any() == true)
                    {
                    <div class="d-flex flex-wrap gap-2">
                        @foreach (var genre in Model.MovieGenres)
                        {
                        <span class="badge bg-primary">@(genre.Genre?.GenreName ?? "Unknown")</span>
                        }
                    </div>
                    }
                    else
                    {
                    <p>No genres listed.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Keywords -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#keywords">
                    Keywords
                </button>
            </h2>
            <div id="keywords" class="accordion-collapse collapse" data-bs-parent="#movieDetailsAccordion">
                <div class="accordion-body">
                    @if (Model.MovieKeywords?.Any() == true)
                    {
                    <div class="d-flex flex-wrap gap-2">
                        @foreach (var keyword in Model.MovieKeywords)
                        {
                        <span class="badge bg-secondary">@(keyword.Keyword?.KeywordName ?? "Unknown")</span>
                        }
                    </div>
                    }
                    else
                    {
                    <p>No keywords available.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <a asp-action="Index" class="btn btn-secondary">Back to List</a>
        <a asp-action="Edit" asp-route-id="@Model.MovieId" class="btn btn-primary">Edit</a>
    </div>
</div>

@section Scripts {
<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("Accordion script loaded.");
    });
</script>
}
